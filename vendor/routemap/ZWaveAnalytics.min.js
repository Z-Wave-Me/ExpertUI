window.ZWaveNetworkAnalyticsLib=function(){function t(b,a){return b.length===a.length&&b.every(function(c,d){return c===a[d]})}function p(b){return b.reduce(function(a,c){return a+c},0)}function v(b){return b.filter(function(a,c,d){return d.indexOf(a)===c})}function u(b){b.sort(function(a,c){return a-c})}function n(b,a){this.src=b;this.u=a;this.H=[];this.B=this.I=0}function k(){this.links=[]}function q(b,a){this.src=b;this.u=a;this.j=[];this.J=this.D=this.S=this.V=this.A=0}function r(b){this.G=0;
this.path=b.slice()}function l(){this.F=[]}function g(b,a,c){this.g=b;this.m=a;this.ka=c||[];this.v=this.g.controller.data.nodeId.value;this.s=[];this.links=[];this.h=new k;this.o=new l;this.W=[];this.qa();this.na();this.oa();this.ma();this.ra();this.pa()}n.prototype.use=function(b,a,c,d){this.I+=void 0!==d?d:1;c=127===c||void 0===c||-32<c&&125>c||-94>c?null:125===c?-94:126===c?-32:c;null!==c&&this.H.push(c)};n.prototype.K=function(){this.B++};n.prototype.usage=function(){return this.I};n.prototype.T=
function(){return this.H};k.prototype.use=function(b,a,c,d,e){this.l(b,a).use(b,a,c,e);this.l(a,b).use(b,a,d,0)};k.prototype.K=function(b,a){this.l(b,a).K()};k.prototype.U=function(b,a,c,d,e,f){var h=c.slice();h.unshift(b);b=c.slice();b.push(a);a=d?d.slice():void 0;c=e?e.slice():void 0;for(var m=0;m<h.length;m++)this.use(h[m],b[m],d?a[m]:void 0,e?c[m]:void 0,f)};k.prototype.l=function(b,a){var c=this.links.filter(function(d){return d.src==b&&d.u==a})[0];c||(c=new n(b,a),this.links.push(c));return c};
k.prototype.usage=function(b,a){var c=Math.max(0,Math.max.apply(null,this.links.map(function(e){return e.usage()}))),d=this.l(b,a).usage();return 0!==c?d/c:0};k.prototype.L=function(b,a){var c=this.l(b,a),d=c.usage();return 0!==d?c.B/d:0};k.prototype.T=function(b,a){var c;return(c=(c=this.l(b,a).H)?p(c)/c.length:void 0)?(c-0)/-100:0};q.prototype.send=function(b,a,c){var d=this.j.filter(function(e){return t(e.path,b)})[0];d||(d=new r(b),this.j.push(d));d.use();this.A++;this.S+=a;c&&this.V++};q.prototype.R=
function(b,a){var c=this.j.filter(function(d){return t(d.path,b)})[0];c||(c=new r(b),this.j.push(c));c.use();this.D++;this.J+=a?1:0};q.prototype.getStats=function(){var b=this.j.map(function(c){return c.path.length}),a=this.j.map(function(c){return c.path});return{minOutHops:Math.min.apply(null,b),maxOutHops:Math.max.apply(null,b),routes:a,retries:this.A?this.S/this.A:null,deliveryRate:this.A?this.V/this.A:null,sent:this.A,explores:this.D?this.J/this.D:null,received:this.D}};r.prototype.use=function(){this.G++};
l.prototype.C=function(b,a){var c=this.F.filter(function(d){return d.src==b&&d.u==a})[0];c||(c=new q(b,a),this.F.push(c));return c};l.prototype.send=function(b,a,c,d,e){this.C(b,a).send(c,d,e)};l.prototype.R=function(b,a,c,d){this.C(b,a).R(c,d)};l.prototype.ga=function(b,a){return this.C(b,a).j};l.prototype.P=function(b,a){return this.C(b,a).getStats()};l.prototype.O=function(b,a){var c=this.ga(b,a),d=new k;c.forEach(function(e){d.U(b,a,e.path,void 0,void 0,e.G)});return d};l.prototype.M=function(b){var a=
0,c=0;this.F.forEach(function(d){a+=p(d.j.map(function(e){return-1===e.path.indexOf(b)?0:e.G}));c+=p(d.j.map(function(e){return e.G}))});return c?a/c:0};l.prototype.N=function(b){var a=[];this.F.forEach(function(c){0<p(c.j.map(function(d){return-1===d.path.indexOf(b)?0:1}))&&a.push(c.u)});u(a);return a};g.prototype.qa=function(){var b=this;this.m.forEach(function(a){if(a.frameType&&(!b.g.devices[a.nodeId]||1!==b.g.devices[a.nodeId].data.basicType.value)&&(b.o.R(a.nodeId,b.v,a.hops||[],"Explore Frame"===
a.frameType),a.hops)){var c=Array(a.hops.length+1);c[a.hops.length]=a.RSSI;b.h.U(a.nodeId,b.v,a.hops,void 0,c,1)}});this.Z=!1;this.m.forEach(function(a){a.frameType||b.g.devices[a.nodeId]&&1===b.g.devices[a.nodeId].data.basicType.value||!a.hops||(b.Z=!0,b.o.send(b.v,a.nodeId,a.hops,a.tries-1,a.delivered),b.h.U(b.v,a.nodeId,a.hops,a.returnRSSI,void 0,1),0!=a.lastFailPath[0]&&b.h.K(a.lastFailPath[0],a.lastFailPath[1]))})};g.prototype.na=function(){var b=this;for(a in this.g.devices){var a=parseInt(a,
10);if(1!==this.g.devices[a].data.basicType.value){var c=a===this.v?"Controller":!1===this.g.devices[a].data.isListening.value?!0===this.g.devices[a].data.sensor250.value||!0===this.g.devices[a].data.sensor1000.value?"FLiRS":"Sleeping":"Routing";this.s.push({id:a,usage:this.o.M(a),type:c,x:null,y:null,name:this.g.devices[a].data.givenName.value,dead:this.g.devices[a].data.isFailed.value});c=this.g.devices[a].data.neighbours.value.slice();var d=c.filter(function(f){return!!b.g.devices[f]});d.length!==
c.length&&(console.log("Fixed neighbours for node "+a+" from "+c+" to "+d),c=d);for(var e in this.g.devices)e=parseInt(e,10),-1===c.indexOf(e)&&(this.g.devices[e]&&-1!==this.g.devices[e].data.neighbours.value.indexOf(a)?(console.log("Adding asymmetrical route "+a+" -> "+e+" to official neighbour list"),c.push(e)):this.g.devices[e]&&1!==this.g.devices[e].data.basicType.value&&(0<this.h.usage(a,e)||0<this.h.usage(e,a))&&this.g.devices[e]&&(console.log("Adding actual route "+a+" -> "+e+" to official neighbour list"),
c.push(e)));c.forEach(function(f){if(a!=f){var h=b.links.filter(function(m){return m.source==f&&m.target==a})[0];h?Object.assign(h,{rssi21:b.h.T(a,f),usage21:b.h.usage(a,f),fails21:b.h.L(a,f)}):b.links.push({source:a,target:f,rssi12:b.h.T(a,f),usage12:b.h.usage(a,f),fails12:b.h.L(a,f)})}})}}this.links.forEach(function(f){0===b.s.filter(function(h){return h.id===f.source}).length&&(console.log("Adding phantom node "+f.source),b.s.push({id:f.source,usage:b.o.M(f.source),type:"Phantom",x:null,y:null,
name:"Node not in controller",dead:!1}));0===b.s.filter(function(h){return h.id===f.target}).length&&(console.log("Adding phantom node "+f.target),b.s.push({id:f.target,usage:b.o.M(f.target),type:"Phantom",x:null,y:null,name:"Node not in controller",dead:!1}))})};g.prototype.oa=function(){var b=this;this.s.map(function(a){var c=b.ka.filter(function(d){return d.id===a.id})[0];c&&(a.x=c.x,a.y=c.y)})};g.prototype.ma=function(){for(b in this.g.devices){var b=parseInt(b,10);var a=[];var c=this.g.devices[b].instances,
d;for(d in c){if(c[d].commandClasses[133])for(var e in c[d].commandClasses[133].data)e=parseInt(e,10),!isNaN(e)&&c[d].commandClasses[133].data[e].nodes.value&&c[d].commandClasses[133].data[e].nodes.value.forEach(function(h){a.push(h)});if(c[d].commandClasses[142])for(e in c[d].commandClasses[142].data)if(e=parseInt(e,10),!isNaN(e)&&c[d].commandClasses[142].data[e].nodesInstances.value){var f=0;c[d].commandClasses[142].data[e].nodesInstances.value.forEach(function(h){0===f++%2&&a.push(h)})}}u(a);this.W[b]=
v(a)}};g.prototype.ra=function(){var b=[],a=this.m[0]&&this.m[0].updateTime||0,c=this.m[0]&&this.m[0].updateTime||0;for(d in this.g.devices){var d=parseInt(d,10);1!==this.g.devices[d].data.basicType.value&&b.push(d)}this.m.forEach(function(e){if(e.delivered||e.dstNodeId){var f=b.indexOf(e.nodeId);-1!==f&&b.splice(f,1)}a<e.updateTime&&(a=e.updateTime);c>e.updateTime&&(c=e.updateTime)});this.ja=b;this.sa=a;this.$=c;this.la=this.m.length};g.prototype.pa=function(){var b={};for(a in this.g.devices){var a=
parseInt(a,10);b[a]||(b[a]={});if(this.g.devices[a].data.priorityRoutes)for(var c in this.g.devices[a].data.priorityRoutes)if(c=parseInt(c,10),!isNaN(c)){var d=this.g.devices[a].data.priorityRoutes[c].value,e=[];if(d){for(var f=0;4>f&&0!==d[f];f++)232<d[f]&&(e=null),e.push(d[f]);if(null===e)break;b[a][c]=e}}}this.i=b};g.prototype.ba=function(b){return this.W[b]};g.prototype.ca=function(){return this.s};g.prototype.aa=function(){return this.links};g.prototype.X=function(){return this.v};g.prototype.ha=
function(b){return this.g.devices[b].data.isListening.value};g.prototype.N=function(b){var a=this,c=this.X();return this.o.N(b).filter(function(d){return 1!==a.g.devices[d].data.basicType.value&&d!=c})};g.prototype.O=function(b,a){var c=this,d=this.o.O(b,a);d.links.forEach(function(e){e.B=c.h.l(e.src,e.u).B+c.h.l(e.u,e.src).B});return d};g.prototype.P=function(b,a){return this.o.P(b,a)};g.prototype.ia=function(b,a,c){b=this.Y(b)[a];if(!b||b.length!=c.length)return!1;for(a=0;a<b.length;a++)if(b[a]!==
c[a])return!1;return!0};g.prototype.Y=function(b){var a={},c;for(c in this.i[b])a[c]=this.i[b][c].slice();return a};g.prototype.da=function(){var b={},a;for(a in this.i)for(var c in this.i[a])b[a]||(b[a]={}),b[a][c]=this.i[a][c].slice();return b};g.prototype.ta=function(b,a,c){c?(this.i[b]||(this.i[b]={}),this.i[b][a]=c):this.i[b]&&this.i[b][a]&&delete this.i[b][a]};g.prototype.fa=function(b,a,c){return b.usage(a,c)};g.prototype.ea=function(b,a,c){return b.L(a,c)};g.prototype.getStats=function(){return{haveIMA:this.Z,
nodeNoStatistics:this.ja,startStatistics:this.sa,endStatistics:this.$,packetsCount:this.la}};return g}();window.ZWaveNetworkAnalyticsLib.prototype.getNodes=window.ZWaveNetworkAnalyticsLib.prototype.ca;window.ZWaveNetworkAnalyticsLib.prototype.getLinks=window.ZWaveNetworkAnalyticsLib.prototype.aa;window.ZWaveNetworkAnalyticsLib.prototype.getMyNodeId=window.ZWaveNetworkAnalyticsLib.prototype.X;window.ZWaveNetworkAnalyticsLib.prototype.isListening=window.ZWaveNetworkAnalyticsLib.prototype.ha;
window.ZWaveNetworkAnalyticsLib.prototype.getNodeAssociations=window.ZWaveNetworkAnalyticsLib.prototype.ba;window.ZWaveNetworkAnalyticsLib.prototype.getNodesRoutedFor=window.ZWaveNetworkAnalyticsLib.prototype.N;window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryLinkMap=window.ZWaveNetworkAnalyticsLib.prototype.O;window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryStats=window.ZWaveNetworkAnalyticsLib.prototype.P;window.ZWaveNetworkAnalyticsLib.prototype.isPriorityRoute=window.ZWaveNetworkAnalyticsLib.prototype.ia;
window.ZWaveNetworkAnalyticsLib.prototype.getNodePriorityRoutes=window.ZWaveNetworkAnalyticsLib.prototype.Y;window.ZWaveNetworkAnalyticsLib.prototype.getPriorityRoutes=window.ZWaveNetworkAnalyticsLib.prototype.da;window.ZWaveNetworkAnalyticsLib.prototype.updatePriorityRoute=window.ZWaveNetworkAnalyticsLib.prototype.ta;window.ZWaveNetworkAnalyticsLib.prototype.getStatUsage=window.ZWaveNetworkAnalyticsLib.prototype.fa;window.ZWaveNetworkAnalyticsLib.prototype.getStatFailRate=window.ZWaveNetworkAnalyticsLib.prototype.ea;
window.ZWaveNetworkAnalyticsLib.prototype.getStats=window.ZWaveNetworkAnalyticsLib.prototype.getStats;